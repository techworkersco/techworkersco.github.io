# Documentation

*This document reviews working with this site and how publishing works.*

## Requirements

- [Bundler](https://bundler.io)
- [Yarn](https://yarnpkg.com/en/)

## Dependencies

### Gems

- [jekyll](https://jekyllrb.com) ([Latest](https://github.com/jekyll/jekyll/releases/latest)) ([Cheat Sheet](https://learn.cloudcannon.com/jekyll-cheat-sheet/))
- [jekyll-sitemap](https://github.com/jekyll/jekyll-sitemap)
- [jekyll-paginate](https://github.com/jekyll/jekyll-paginate)
- [danger](https://danger.systems/ruby/)

### Yarn

- [Bootstrap](https://getbootstrap.com) ([pkg](https://yarnpkg.com/en/package/bootstrap))
- [jQuery](https://jquery.com) ([pkg](https://yarnpkg.com/en/package/jquery))

> Note: we specify a custom install path `./yarn_deps/` to workaround GH-pages ignoring `./node_modules/`.

### Other

- [FontAwesome 5](https://fontawesome.com)

## Usage

### Installation

```bash
$ git clone https://github.com/techworkersco/techworkersco.github.io.git
$ cd techworkersco.github.io/
$ make install
$ make
```

### Building the site

There are various options using `make`:

```bash
$ make build # build the site once
$ make watch # build and watch for changes
$ make incr # build incrementally and watch for changes
$ make future # build once and allow future posts
$ make draft # build and watch, including _drafts/
```

### Previewing the site locally

```bash
$ make serve # browse to http://localhost:4000
```

### Updating dependencies

```bash
$ make update
```

### Generating a new issue

This will generate an empty issue template in `_drafts/`.

```bash
$ make new
```

# Writing and Publishing

*Tips and other information for core contributors.*

## Process

See our [Process documentation](https://github.com/techworkersco/techworkersco.github.io/blob/master/.github/PROCESS.md).

## How we publish

Everything centers around our git workflow and GitHub. Once pull requests are merged, the site is rebuilt and deployed. This includes generating an RSS feed.

### Emails

Emails are sent via Mailchimp at 10:00 AM Pacific, using the [RSS-to-email feature](https://mailchimp.com/features/rss-to-email/). After merging a new post to `master`, an RSS feed entry is added as part of regenerating the site. Mailchimp checks for updates to the RSS feed, and after finding a new entry an email is generated and sent.

Emails are sent from **news-noreply@techworkerscoalition.org**.

Pull request reviews are partially automated with the help of [Danger](https://danger.systems/ruby/).

### Tweets

We use [IFTT](https://ifttt.com) to auto-tweet new issues from the RSS feed to our [twitter account](https://twitter.com/twcnewsletter).

## Issue Template

You can find a default issue template at [`_drafts/template.md`](https://github.com/techworkersco/techworkersco.github.io/blob/master/_drafts/template.md).

A new issue template can be generated by running [`./scripts/new_post.rb <ISSUE #>`](https://github.com/techworkersco/techworkersco.github.io/blob/master/scripts/new_post.rb).

All issues should include an `<!--excerpt-->` tag.

### Front Matter

Below is an explanation of our Jekyll [front matter](https://jekyllrb.com/docs/front-matter/) fields.

```yaml
---
layout: post
title: ! 'Issue #N: TITLE' # where N is the issue number
category: Volume 2
image:
    file: vol-2-issue-1-header.jpg
    alt: 'img alt text'
    caption: 'img caption text'
    source_link: 'link to img external source'
    half_width: false # img layout
preview: 'preview text for emails + social media'
---
```

We always use the `post` layout, and the `title` should take the form: `Issue #1: My Title`.

The `preview` field is used to generate the email and social media preview text. If not provided, the post excerpt will be used.

### Categories as "Volumes"

We use a single `category:` field in the Jekyll [front matter](https://jekyllrb.com/docs/front-matter/) to specify a "Volume" for each issue.

These are the valid values for this field:

- `Volume 1` (represents the original, legacy newsletter)
- `Volume 2` (the reboot, beginning in early 2020)

### Header Images

All images should be placed in [`img/`](https://github.com/techworkersco/techworkersco.github.io/tree/master/img).

> :warning: Be sure to run [ImageOptim](https://imageoptim.com/mac) on all images to reduce their file size.

Each post has an optional header image, specified by the `image:` field.

- `file` **(required, string)** specifies the filename only. (example: `vol-1-issue-1-header.jpg`)

- `alt` **(optional, string)** specifies the contents of the `img` tag `alt` attribute.

- `caption` **(optional, string)** the caption text to be displayed below the image.

- `source_link` **(optional, link)** a link to the original source of the image, to be displayed as a link title "Source" below the image.

- `half_width` **(optional, boolean)** specifies the image layout. If `false` (the default), the image will expand to the full width of the container. If `true`, the image is centered and expands to 50% of the container width. This should almost always be `false`.

### Handling Links

> :warning: **Relative links in posts should be avoided.**
>
> Because the newsletter email is generated from the RSS feed, site links must be prepended with `{{ site.url }}`, for example:
>
> `[about]({{ site.url}}/about/)`

- To other posts: `[link]({{ site.url }}{% post_url 2000-01-01-issue-title %})`
- To other images: `{{ site.url }}{{ site.img_url}}/image-name.jpg`
